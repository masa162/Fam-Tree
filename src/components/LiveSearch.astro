---
---
<div id="search-component" class="relative mb-8">
  <input type="text" id="search-input" placeholder="ðŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢..." class="input input-bordered w-full">
</div>

<script>
  import Fuse from 'fuse.js';

  const searchInput = document.getElementById('search-input');
  let fuse;
  let posts = [];
  let allArticleElements = [];

  // æœ€åˆã«ã™ã¹ã¦ã®è¨˜äº‹è¦ç´ ã‚’å–å¾—ã—ã¦ãŠã
  document.addEventListener('DOMContentLoaded', () => {
    allArticleElements = Array.from(document.querySelectorAll('.article-card'));
  });

  // æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
  fetch('/api/search.json')
    .then(response => response.json())
    .then(data => {
      posts = data;
      fuse = new Fuse(posts, {
        keys: ['title', 'description', 'tags'],
        includeScore: true,
        threshold: 0.4,
      });
    });

  // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ
  searchInput.addEventListener('input', (e) => {
    const query = e.target.value;

    // å…¥åŠ›ãŒç©ºã®å ´åˆã¯ã™ã¹ã¦ã®è¨˜äº‹ã‚’è¡¨ç¤º
    if (query.length === 0) {
      allArticleElements.forEach(el => el.style.display = 'block');
      return;
    }

    const results = fuse.search(query);
    const visibleSlugs = new Set(results.map(r => r.item.slug));

    // è¡¨ç¤ºãƒ»éžè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
    allArticleElements.forEach(el => {
      const slug = el.getAttribute('data-slug');
      if (visibleSlugs.has(slug)) {
        el.style.display = 'block';
      } else {
        el.style.display = 'none';
      }
    });
  });
</script>
